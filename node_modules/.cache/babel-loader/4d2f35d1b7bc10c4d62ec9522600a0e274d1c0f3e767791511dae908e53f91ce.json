{"ast":null,"code":"import React,{useEffect,useState}from'react';import axios from'axios';import{useParams,useLocation,Link}from'react-router-dom';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const TMDB_API_KEY=process.env.REACT_APP_TMDB_API_KEY;export default function Details(){const{id}=useParams();const location=useLocation();// ← ADDED: To detect ?t= cache buster\nconst[movie,setMovie]=useState(null);const[reviews,setReviews]=useState([]);const[loading,setLoading]=useState(true);const[error,setError]=useState('');useEffect(()=>{if(!TMDB_API_KEY){setError('TMDB API key missing. Check .env file.');setLoading(false);return;}async function loadData(){try{setLoading(true);setError('');const[movieRes,reviewRes]=await Promise.all([axios.get(\"https://api.themoviedb.org/3/movie/\".concat(id,\"?api_key=\").concat(TMDB_API_KEY)),axios.get(\"\".concat(process.env.REACT_APP_BACKEND_URL||'http://localhost:5000',\"/api/reviews/movie/\").concat(id)).catch(()=>({data:[]}))]);setMovie(movieRes.data);setReviews(reviewRes.data);}catch(err){var _err$response,_err$response2;console.error('Load error:',err);setError(((_err$response=err.response)===null||_err$response===void 0?void 0:_err$response.status)===401?'Invalid TMDB API key.':((_err$response2=err.response)===null||_err$response2===void 0?void 0:_err$response2.status)===404?'Movie not found.':'Failed to load data. Check network or backend.');}finally{setLoading(false);}}loadData();// Optional: Auto-refresh every 10 seconds\nconst interval=setInterval(loadData,10000);return()=>clearInterval(interval);},[id,location.search]);// ← CRITICAL: Reload when ?t= changes\nif(loading)return/*#__PURE__*/_jsx(\"div\",{className:\"container py-5 text-center\",children:\"Loading...\"});if(error)return/*#__PURE__*/_jsx(\"div\",{className:\"container py-5 alert alert-danger\",children:error});if(!movie)return/*#__PURE__*/_jsx(\"div\",{className:\"container py-5 text-center\",children:\"Movie not found.\"});// Calculate average rating\nconst avgRating=reviews.length>0?(reviews.reduce((sum,r)=>sum+r.rating,0)/reviews.length).toFixed(1):'—';return/*#__PURE__*/_jsxs(\"div\",{className:\"container py-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"row\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"col-md-4\",children:movie.poster_path?/*#__PURE__*/_jsx(\"img\",{src:\"https://image.tmdb.org/t/p/w500\".concat(movie.poster_path),alt:movie.title,className:\"img-fluid rounded shadow\"}):/*#__PURE__*/_jsx(\"div\",{className:\"bg-light rounded d-flex align-items-center justify-content-center\",style:{height:'500px'},children:/*#__PURE__*/_jsx(\"span\",{className:\"text-muted\",children:\"No Image\"})})}),/*#__PURE__*/_jsxs(\"div\",{className:\"col-md-8\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"display-5 fw-bold\",children:movie.title}),/*#__PURE__*/_jsx(\"p\",{className:\"text-muted\",children:movie.tagline||''}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Release:\"}),\" \",movie.release_date||'Unknown']}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"TMDB Rating:\"}),\" \",movie.vote_average,\"/10 (\",movie.vote_count,\" votes)\"]}),/*#__PURE__*/_jsxs(\"p\",{className:\"fs-4\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"User Average:\"}),' ',/*#__PURE__*/_jsxs(\"span\",{className:\"text-warning ms-2\",children:[avgRating!=='—'?\"\".concat(avgRating,\"/5\"):'—',' ',\"(\",reviews.length,\" review\",reviews.length!==1?'s':'',\")\"]})]}),/*#__PURE__*/_jsx(\"p\",{children:movie.overview||'No description available.'}),/*#__PURE__*/_jsx(Link,{to:\"/add-review?movieId=\".concat(id,\"&movieTitle=\").concat(encodeURIComponent(movie.title)),className:\"btn btn-primary btn-lg\",children:\"Write a Review\"})]})]}),/*#__PURE__*/_jsx(\"hr\",{className:\"my-5\"}),/*#__PURE__*/_jsxs(\"h3\",{children:[\"User Reviews (\",reviews.length,\")\"]}),reviews.length===0?/*#__PURE__*/_jsx(\"p\",{className:\"text-muted\",children:\"No reviews yet. Be the first!\"}):/*#__PURE__*/_jsx(\"div\",{className:\"row\",children:reviews.map(r=>{var _r$createdAt,_r$createdAt$toDate,_r$createdAt$toDate$c;return/*#__PURE__*/_jsx(\"div\",{className:\"col-md-6 mb-3\",children:/*#__PURE__*/_jsx(\"div\",{className:\"card h-100\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"card-body d-flex flex-column\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex justify-content-between mb-2\",children:[/*#__PURE__*/_jsx(\"strong\",{children:r.userName||'Anonymous'}),/*#__PURE__*/_jsxs(\"span\",{className:\"text-warning\",children:['★'.repeat(r.rating),'☆'.repeat(5-r.rating)]})]}),/*#__PURE__*/_jsx(\"p\",{className:\"flex-grow-1\",children:r.text}),/*#__PURE__*/_jsx(\"small\",{className:\"text-muted\",children:((_r$createdAt=r.createdAt)===null||_r$createdAt===void 0?void 0:(_r$createdAt$toDate=_r$createdAt.toDate)===null||_r$createdAt$toDate===void 0?void 0:(_r$createdAt$toDate$c=_r$createdAt$toDate.call(_r$createdAt))===null||_r$createdAt$toDate$c===void 0?void 0:_r$createdAt$toDate$c.toLocaleDateString())||'Just now'})]})})},r.id);})})]});}","map":{"version":3,"names":["React","useEffect","useState","axios","useParams","useLocation","Link","jsx","_jsx","jsxs","_jsxs","TMDB_API_KEY","process","env","REACT_APP_TMDB_API_KEY","Details","id","location","movie","setMovie","reviews","setReviews","loading","setLoading","error","setError","loadData","movieRes","reviewRes","Promise","all","get","concat","REACT_APP_BACKEND_URL","catch","data","err","_err$response","_err$response2","console","response","status","interval","setInterval","clearInterval","search","className","children","avgRating","length","reduce","sum","r","rating","toFixed","poster_path","src","alt","title","style","height","tagline","release_date","vote_average","vote_count","overview","to","encodeURIComponent","map","_r$createdAt","_r$createdAt$toDate","_r$createdAt$toDate$c","userName","repeat","text","createdAt","toDate","call","toLocaleDateString"],"sources":["C:/Users/BRAINTECH/Desktop/movie-review-platform-movies/frontend/src/pages/Details.js"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport axios from 'axios';\nimport { useParams, useLocation, Link } from 'react-router-dom';\n\nconst TMDB_API_KEY = process.env.REACT_APP_TMDB_API_KEY;\n\nexport default function Details() {\n  const { id } = useParams();\n  const location = useLocation(); // ← ADDED: To detect ?t= cache buster\n  const [movie, setMovie] = useState(null);\n  const [reviews, setReviews] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState('');\n\n  useEffect(() => {\n    if (!TMDB_API_KEY) {\n      setError('TMDB API key missing. Check .env file.');\n      setLoading(false);\n      return;\n    }\n\n    async function loadData() {\n      try {\n        setLoading(true);\n        setError('');\n\n        const [movieRes, reviewRes] = await Promise.all([\n          axios.get(`https://api.themoviedb.org/3/movie/${id}?api_key=${TMDB_API_KEY}`),\n          axios.get(`${process.env.REACT_APP_BACKEND_URL || 'http://localhost:5000'}/api/reviews/movie/${id}`)\n            .catch(() => ({ data: [] }))\n        ]);\n\n        setMovie(movieRes.data);\n        setReviews(reviewRes.data);\n      } catch (err) {\n        console.error('Load error:', err);\n        setError(\n          err.response?.status === 401\n            ? 'Invalid TMDB API key.'\n            : err.response?.status === 404\n            ? 'Movie not found.'\n            : 'Failed to load data. Check network or backend.'\n        );\n      } finally {\n        setLoading(false);\n      }\n    }\n\n    loadData();\n\n    // Optional: Auto-refresh every 10 seconds\n    const interval = setInterval(loadData, 10000);\n    return () => clearInterval(interval);\n  }, [id, location.search]); // ← CRITICAL: Reload when ?t= changes\n\n  if (loading) return <div className=\"container py-5 text-center\">Loading...</div>;\n  if (error) return <div className=\"container py-5 alert alert-danger\">{error}</div>;\n  if (!movie) return <div className=\"container py-5 text-center\">Movie not found.</div>;\n\n  // Calculate average rating\n  const avgRating = reviews.length > 0\n    ? (reviews.reduce((sum, r) => sum + r.rating, 0) / reviews.length).toFixed(1)\n    : '—';\n\n  return (\n    <div className=\"container py-4\">\n      <div className=\"row\">\n        <div className=\"col-md-4\">\n          {movie.poster_path ? (\n            <img\n              src={`https://image.tmdb.org/t/p/w500${movie.poster_path}`}\n              alt={movie.title}\n              className=\"img-fluid rounded shadow\"\n            />\n          ) : (\n            <div className=\"bg-light rounded d-flex align-items-center justify-content-center\" style={{ height: '500px' }}>\n              <span className=\"text-muted\">No Image</span>\n            </div>\n          )}\n        </div>\n        <div className=\"col-md-8\">\n          <h1 className=\"display-5 fw-bold\">{movie.title}</h1>\n          <p className=\"text-muted\">{movie.tagline || ''}</p>\n          <p><strong>Release:</strong> {movie.release_date || 'Unknown'}</p>\n          <p><strong>TMDB Rating:</strong> {movie.vote_average}/10 ({movie.vote_count} votes)</p>\n\n          {/* USER AVERAGE RATING */}\n          <p className=\"fs-4\">\n            <strong>User Average:</strong>{' '}\n            <span className=\"text-warning ms-2\">\n              {avgRating !== '—' ? `${avgRating}/5` : '—'}{' '}\n              ({reviews.length} review{reviews.length !== 1 ? 's' : ''})\n            </span>\n          </p>\n\n          <p>{movie.overview || 'No description available.'}</p>\n          <Link\n            to={`/add-review?movieId=${id}&movieTitle=${encodeURIComponent(movie.title)}`}\n            className=\"btn btn-primary btn-lg\"\n          >\n            Write a Review\n          </Link>\n        </div>\n      </div>\n\n      <hr className=\"my-5\" />\n\n      <h3>User Reviews ({reviews.length})</h3>\n      {reviews.length === 0 ? (\n        <p className=\"text-muted\">No reviews yet. Be the first!</p>\n      ) : (\n        <div className=\"row\">\n          {reviews.map(r => (\n            <div className=\"col-md-6 mb-3\" key={r.id}>\n              <div className=\"card h-100\">\n                <div className=\"card-body d-flex flex-column\">\n                  <div className=\"d-flex justify-content-between mb-2\">\n                    <strong>{r.userName || 'Anonymous'}</strong>\n                    <span className=\"text-warning\">\n                      {'★'.repeat(r.rating)}{'☆'.repeat(5 - r.rating)}\n                    </span>\n                  </div>\n                  <p className=\"flex-grow-1\">{r.text}</p>\n                  <small className=\"text-muted\">\n                    {r.createdAt?.toDate?.()?.toLocaleDateString() || 'Just now'}\n                  </small>\n                </div>\n              </div>\n            </div>\n          ))}\n        </div>\n      )}\n    </div>\n  );\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}